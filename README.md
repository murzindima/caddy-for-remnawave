# Caddy for Remnawave

Обратный прокси для Remnawave на основе Caddy. Предоставляется два варианта конфигурации:
1. Multi-port: Xray на 443 порту, панель и подписки на кастомных портах
2. Xray-proxy: Вся маршрутизация через Remnawave ноду на 443 порту

## Вариант 1: Multi-port конфигурация

В этой конфигурации панель и подписки запускаются на кастомных портах, а Xray на 443 порту. Также предоставляется selfsteal заглушка, вам осталось отредактировать .env и (желательно) поменять статику в папкe `html` на свою.

### Установка и запуск

1. Склонируйте репозиторий:

```bash
git clone https://github.com/xxphantom/caddy-for-remnawave.git
cd caddy-for-remnawave
```

2. Скопируйте файл .env.sample и отредактируйте файл `.env`:

```bash
cp .env.sample .env
vim .env
```

- Поменяйте значения в `.env`

3. Запустите проект:

```bash
docker compose up -d
```

## Вариант 2: Запуск всех сервисов 443 порту с помощью локальной Remnawave ноды

В этой конфигурации Remnawave нода обрабатывает весь входящий трафик на 443 порту. Все запросы, которые не являются Xray-proxy-соединениями уходят в dest fallback и перенаправляются в Caddy, который затем распределяет их по нужным сервисам (панель, selfsteal, подписки). 

ВАЖНО! Для того, чтобы этот вариант конфирурации заработал, требуется сначала запустить панель на кастомном поруту (первый вариант) и настроить локальную Remnawave ноду на 443 порту (либо пробросить порт 3000 порт до локальной машины, или обратиться к API на 3000 порту для добавления конфигурации локальной ноды).

### Установка и запуск

1. Склонируйте репозиторий:

```bash
git clone https://github.com/xxphantom/caddy-for-remnawave.git
cd caddy-for-remnawave
```

2. Скопируйте файл .env.sample и отредактируйте файл `.env`:

```bash
cp .env.sample .env
vim .env
```

- Поменяйте значения в `.env`

3. Запустите проект с альтернативной конфигурацией:

```bash
docker compose -f docker-compose.xray-proxy.yml up -d
```

В этой конфигурации:
- Remnawave нода обрабатывает весь трафик на 443 порту
- Не-Xray запросы передаются в Caddy
- Caddy обрабатывает веб-трафик (панель, selfsteal, подписки)
- Настроен proxy_protocol для безопасной передачи информации между нодой и Caddy
